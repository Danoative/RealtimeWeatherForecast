<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--tab icon-->
    <link rel="shortcut icon" href="/General/assets/weather/clouds.svg" type="image/svg+xml">

    <!-- Unicons Icons -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">

    <!-- CSS -->
    <link rel="stylesheet" href="/Homepage/assets/css/style.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/Homepage/assets/images/favicon.png" type="image/x-icon">

    <title>Weather Forecast</title>
</head>
<body>
    <div class="container">
    <!-- HEADER -->
    <nav id="header">
        <!-- <div class="nav-logo">
            <p class="nav-name">Test</p>
            <span>.</span>
        </div> -->
        <div class="nav-menu" id="myNavMenu">
            <ul class="nav_menu_list">
                <li class="nav_list">
                    <a href="#home" class="nav-link active-link">Home</a>
                    <div class="circle"></div>
                </li>
                <li class="nav_list">
                    <a href="#about" class="nav-link">About</a>
                    <div class="circle"></div>
                </li>
                <li class="nav_list">
                    <a href="#projects" class="nav-link">Projects</a>
                    <div class="circle"></div>
                </li>
            </ul>
        </div>
        <div class="nav-button">
            <button class="btn" id="form-open">Login</button>
        </div>
        <div class="nav-menu-btn">
            <i class="uil uil-bars" onclick="myMenuFunction()"></i>
        </div>
    </nav>


    <!-- MAIN -->
        <main class="wrapper">
            <!-- HOME BOX -->
            <section class="home" id="home">
                <div class="form_container">
                    <i class="uil uil-times form_close"></i>
                    <!-- LOGIN FORM -->
                    <div class="form login_form">
                        <form action="/login" id="loginForm">
                            <h2>Login</h2>
                            <div class="input_box">
                                <input type="text" name="username" placeholder="Enter Username" required/>
                                <i class="uil uil-user user"></i>
                            </div>
                            <div class="input_box">
                                <input type="password" name="password" placeholder="Enter Password" required/>
                                <i class="uil uil-lock password"></i>
                                <i class="uil uil-eye-slash pw_hide"></i>
                            </div>

                            <button class="button" type="submit">Login</button>

                            <div class="login_signup"> Don't have an account? <a href="#" id="signup">Signup</a></div>
                        </form>
                    </div>

                    <!-- SIGNUP FORM -->
                    <div class="form signup_form">
                        <form action="/signup">
                            <h2>Signup</h2>

                            <div class="input_box">
                                <input type="text" placeholder="Enter Username" required/>
                                <i class="uil uil-user user"></i>
                            </div>
                            <div class="input_box">
                                <input type="password" placeholder="Create Password" required/>
                                <i class="uil uil-lock password"></i>
                                <i class="uil uil-eye-slash pw_hide"></i>
                            </div>
                            <div class="input_box">
                                <input type="password" placeholder="Confirm Password" required/>
                                <i class="uil uil-lock password"></i>
                                <i class="uil uil-eye-slash pw_hide"></i>
                            </div>

                            <button class="button">Signup</button>

                            <div class="login_signup"> Already have an account? <a href="#" id="login">Login</a></div>
                        </form>
                    </div>
                </div>
                <div class="featured-text">
                    <div class="featured-name">
                        <p> <span>Real-Time Weather Forecast</span></p>
                    </div>
                    <div class="featured-text-info">
                        <p>
                            <div>Ever felt like wanting to know what is the current weather is at the moment and in the coming days?</div>
                            <div>To know will it rainy, stormy, sunny? Go to our website to take a look!</div>
                        </p>
                    </div>
                    <div class="featured-text-btn">

                        <button class="btn form-open-btn">Login</button>
                    </div>
                    
                </div>
                <div class="featured-image">
                    <div class="image">
                        <img src="/Homepage/assets/images/weather_sunny_icon.png" alt="avatar">
                    </div>
                </div>
            </section>
            <!-- ABOUT BOX -->
            <section class="section" id="about">
                <div class="top-header">
                    <h3>About The Website</h3>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="about-info">
                            <h3>Description</h3>
                            <p> Our Website delivers accurate weather forecasts with real-time updates, detailed daily insights, and interactive maps. 
                                Stay informed with personalized alerts and a seamless experience across all devicesâ€”your reliable weather companion! 
                            </p>
                        </div>
                    </div>
                    <div class="col">
                        <div class="skills-box">
                            <div class="skills-header">
                                <h3>Frontend</h3>
                            </div>
                            <div class="skills-list">
                                <span>HTML</span>
                                <span>CSS</span>
                                <span>JavaScript</span>
                            </div>
                        </div>
                        <div class="skills-box">
                            <div class="skills-header">
                                <h3>Backend</h3>
                            </div>
                            <div class="skills-list">
                                <span>HTML</span>
                                <span>CSS</span>
                            </div>
                        </div>
                        <div class="skills-box">
                            <div class="skills-header">
                                <h3>Database</h3>
                            </div>
                            <div class="skills-list">
                                <span>MongoDB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PROJECT BOX -->
            <section class="section" id="projects">
                <div class="top-header">
                    <h1>Our Website Features</h1>
                </div>
                <div class="project-container">
                    <div class="project-box">
                        <i class="uil uil-cloud-sun"></i>
                        <h3>Multiple Parameters</h3>
                        <label>Show pressure, temperature, .etc</label>
                    </div>
                    <div class="project-box">
                        <i class="uil uil-crosshair"></i>
                        <h3>Accurate prediction</h3>
                        <label>Predict with 75% accuracy</label>
                    </div>
                    <div class="project-box">
                        <i class="uil uil-globe"></i>
                        <h3>Everywhere</h3>
                        <label>Can predict every city in the world</label>
                    </div>
                </div>
            </section>
            
        </main>


    <!-- FOOTER -->
    <footer>
        <div class="top-footer">
            <p>Real-time Weather Forecast by Group 2</p>
        </div>
        <div class="middle-footer">
            <ul class="footer-menu">
                <li class="footer_menu_list">
                    <a href="#home">Home</a>
                </li>
                <li class="footer_menu_list">
                    <a href="#about">About</a>
                </li>
                <li class="footer_menu_list">
                    <a href="#projects">Projects</a>
                </li>
            </ul>
        </div>
        <div class="bottom-footer">
            <p><a style="text-decoration: none;">Group 2 Software Engineering</a></p>
        </div>
    </footer>

    </div>

    <script>
        const baseUrl = 'http://localhost:5000/api/auth'; // Update to match your backend URL
    
        // Handle Signup Form Submission
        document.querySelector('.signup_form form').addEventListener('submit', async (e) => {
            e.preventDefault();
    
            const username = e.target[0].value;
            const password = e.target[1].value;
            const confirmPassword = e.target[2].value;
    
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
    
            try {
                const res = await fetch(`${baseUrl}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
    
                const data = await res.json();
                if (res.ok) {
                    alert('Signup successful');
                    console.log('Token:', data.token);
                } else {
                    alert(data.msg || 'Error during signup');
                }
            } catch (err) {
                console.error(err);
                alert('Server error');
            }
        });

     // Handle Login Form Submission
    document.querySelector('.login_form form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = e.target[0].value;
        const password = e.target[1].value;

        try {
            const response = await fetch(`${baseUrl}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
            });

            const data = await response.json();

            if (response.ok) {
                alert('Login successful');
                console.log('Token:', data.token);
                console.log('Username:', data.username);

                // Save username and token to localStorage
                localStorage.setItem('username', data.username);
                localStorage.setItem('token', data.token);
            } else {
                alert(data.msg || 'Error during login');
            }
        } catch (err) {
            console.error('Login error:', err);
            alert('Server error. Please try again.');
        }
    });


    </script>

    <script>
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent default form submission

        const username = document.querySelector('#loginForm input[name="username"]').value;
        const password = document.querySelector('#loginForm input[name="password"]').value;

        fetch('http://localhost:5000/api/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                // Login successful
                if (data.isAdmin) {
                    // Redirect admin users to the Dashboard
                    window.location.href = '../Dashboard/client/admin.html';
                } else {
                    // Redirect regular users to general_ui.html
                    window.location.href = 'general_ui.html';
                }
            } else {
                // Handle login errors
                alert(data.msg || 'Invalid credentials');
            }
        })
        .catch(err => {
            console.error(err);
            alert('An error occurred during login');
        });
    });
    </script>

    <!-- TYPING JS Link -->
    <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>

    <!-- SCROLL REVEAL JS Link -->
    <script src="https://unpkg.com/scrollreveal"></script>

    <!-- MAIN JS -->
    <script src="/Homepage/assets/js/main.js"></script>
</body>
</html>